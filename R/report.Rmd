---
title: "KORA-AMD"
author: "Matina Kasiouri, Sven Morlock, Leo Höltkemeyer"
date: "2023-03-20"
output:
  pdf_document:
    includes:
      header-includes:
      - \usepackage{booktabs}
      - \usepackage{longtable}
      - \usepackage{array}
      - \usepackage{multirow}
      - \usepackage{wrapfig}
      - \usepackage{float}
      - \usepackage{colortbl}
      - \usepackage{pdflscape}
      - \usepackage{tabu}
      - \usepackage{threeparttable}
      - \usepackage{threeparttablex}
      - \usepackage[normalem]{ulem}
      - \usepackage{makecell}
      - \usepackage{xcolor}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
options(warn = -1) 
```

```{r preliminaries, warning=FALSE}
source("preprocess.R")
library(kableExtra)
```

```{r define-functions, echo = FALSE, include = FALSE}
my_kable <- function(dtbl, caption, booktabs = TRUE, col.names = NULL, latex_options = "hold_position") {
  #'
  #'
  #'
  #'
  assertDataTable(dtbl)
  kable(dtbl,
        caption = caption,
        booktabs = booktabs,
        col.names = col.names)
} %>%  kable_styling(latex_options = latex_options)
```

# I Deskriptive Statstik

### §1 General
```{r fit-amd-bl}
as.data.table(table(data_fit[, LT_conti_worst_eye], useNA = "always")) %>% 
  my_kable(caption = "FIT: AMD at BL")
```

```{r fit-amd-fu}
as.data.table(table(data_fit[, PT_conti_worst_eye],useNA = "always")) %>% 
  my_kable(caption = "FIT: AMD at FU")
```

```{r fit-amd-fu-1}
as.data.table(table(data_fit[LT_conti_worst_eye == "no_amd", PT_conti_worst_eye], useNA = "always")) %>% 
  my_kable(caption = "FIT: AMD at FU (no AMD at BL")
```

```{r fit-amd-fu-2}
as.data.table(table(data_fit[LT_conti_worst_eye == "no_amd" | LT_conti_worst_eye == "early", PT_conti_worst_eye],useNA = "always")) %>% 
  my_kable(caption = "FIT: AMD at FU (no AMD or early AMD at BL)")
```

### §2 Incidence and Progression

```{r fit-incidence, echo = FALSE, include = FALSE}
incidences_fit <- get_incidence_tbl(data_fit,
                  amd_bl_col = "LT_conti_worst_eye",
                  amd_fu_col = "PT_conti_worst_eye",
                  split_col = "age_group_fit")
```

```{r fit-incidence-case1}
incidences_fit[["case1"]] %>% 
  my_kable(caption = "Cummulative incidence of early AMD", col.names = NA)
```

```{r fit-incidence-case2}
incidences_fit[["case2"]] %>% 
  my_kable(caption = "Cummulative incidence of late AMD (definition1)", col.names = NA)
```

```{r fit-incidence-case3}
incidences_fit[["case3"]] %>% 
  my_kable(caption= "Cummulative incidence of late AMD (definition)", col.names = NA)
```

```{r fit-incidence-case4}
incidences_fit[["case4"]] %>% 
  my_kable(caption = "Cummulative progression from early to late AMD", col.names = NA)
```